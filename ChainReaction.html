<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/styleBlue.css" />
    <link rel="stylesheet" href="css/styleGreen.css" />
</head>

<body>
    <main>
        <section class="glass">
            <div class="nextButton">Next &#10154;</div>
            <div class="row mainDisplay">
                <div class="col-md-3 scoreBoard"></div>
                <div class="col-md-12 displayBox">
                    <table id="GameOn">
                        <tbody>
                            <tr class="firstWord"></tr>
                            <tr class="secondWord"></tr>
                            <tr class="thirdWord"></tr>
                            <tr class="fourthWord"></tr>
                            <tr class="fifthWord"></tr>
                            <tr class="lastWord"></tr>
                        </tbody>
                    </table>
                    <div id="team">
                        <div class="row">
                            <div class="teamMsg">
                                <h2>Teams playing : </h2>
                                <div class="teamSelect">
                                    <input type="radio" id="team1" name="Team" value="1" checked><label
                                        for="team1">1</label>
                                    <input type="radio" id="team2" name="Team" value="2"><label for="team2">2</label>
                                    <input type="radio" id="team3" name="Team" value="3"><label for="team3">3</label>
                                    <input type="radio" id="team4" name="Team" value="4"><label for="team4">4</label>
                                </div>
                                <div id="teamName">
                                    <div class="input-group team1"><span>&#128038;</span><input class="form-control"
                                            id="teamName1" /></div>
                                    <div class="input-group team2"><span>&#128009;</span><input class="form-control"
                                            id="teamName2" /></div>
                                    <div class="input-group team3"><span>&#128011;</span><input class="form-control"
                                            id="teamName3" /></div>
                                    <div class="input-group team4"><span>&#128008;</span><input class="form-control"
                                            id="teamName4" /></div>
                                    <div id="startGameBtn">
                                        <button class="btn btn-primary">Start Game</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 controlPanel">
                    <div id="checkWordBox">
                        <div><input id="checkWord" onkeypress="return enterKeyPressed(event)" /></div>
                        <br />
                        <div><button class="btn btn-primary checkWordBtn">Check</button></div>
                    </div>
                    <div id="teamTurn">

                    </div>
                </div>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
                crossorigin="anonymous"></script>
        </section>
    </main>
    <label class="switch"> 
        <input type="checkbox">
        <span class="slider round"></span>
    </label>
    <div class="circle1"></div>
    <div class="circle2"></div>
</body>
<script>
    const list = [["Credit", "Check", "Please", "Hold", "Fast", "Food"], ["Cocoa", "Powder", "Blue", "Moon", "Landing", "Gear"], ["Freezing", "Cold", "Sweat", "Shirt", "Button", "Nose"], ["Crushed", "Ice", "Water", "Garden", "Party", "Animal"], ["Glass", "Bubble", "Bath", "Tub", "Stained", "Teeth"], ["Under", "Water", "Gun", "Down", "Town", "Hall"], ["Fire", "Fly", "Weight", "Training", "Day", "Dream"], ["Certain", "Death", "bed", "head", "Master", "Bathroom"], ["simple", "life", "long", "hair", "raising", "money"], ["bowling", "pin", "code", "red", "cross", "country"], ["user", "friendly", "fire", "escape", "artist", "unknown"], ["funky", "town", "square", "foot", "long", "weekend"], ["hidden", "talent", "scout", "leader", "board", "meeting"], ["nothing", "left", "turn", "around", "town", "house"], ["street", "food", "chain", "reaction", "TIME", "CARD"], ["MONKEY", "BUSINESS", "CLASS", "ROOM", "KEY", "CHAIN"], ["CITY", "HALL", "PASS", "OUT", "COLD", "water"], ["chain", "smoke", "signal", "booster", "seat", "belt"], ["bouncing", "baby", "grand", "piano", "key", "chain"], ["away", "game", "time", "travel", "light", "wave"], ["child", "birth", "day", "after", "school", "shopping"], ["remain", "active", "wear", "out", "cry", "baby"], ["fence", "post", "master", "lock", "jaw", "bone"], ["dirty", "dish", "soap", "box", "spring", "break"], ["sweet", "tooth", "fairy", "dust", "cover", "letter"], ["essential", "oil", "field", "hockey", "team", "leader"], ["lemon", "grass", "stain", "proof", "read", "along"], ["authority", "figure", "head", "band", "member", "services"], ["forbidden", "fruit", "cocktail", "dress", "rehearsal", "dinner"], ["grand", "father", "time", "trial", "run", "around"], ["sliced", "bread", "pudding", "pop", "culture", "clash"], ["bullet", "train", "track", "team", "building", "block"], ["sea", "monster", "movie", "theater", "curtain", "call"]];
    var index = randomIndex(list.length);
    var indexTrack = 0;
    var maxWordLen = 9;
    $selectedRow = $('.secondWord');
    var unhideUnavailableRow = [0, 1, 0, 0, 1];
    const team = [{ name: "Kookaburra", symbol: "&#128038;", score: 0, color: '#ffdbd0' }, { name: "Balerion", symbol: '&#128009;', score: 0, color: '#d0ffd8' }, { name: "Orca", symbol: '&#128011;', score: 0, color: '#d0eeff' }, { name: "Life of Pie", symbol: '&#128008;', score: 0, color: '#f8ffd0' }];
    const playingTeam = [];
    $('#teamName1').val(team[0].name);
    $('#teamName2').val(team[1].name);
    $('#teamName3').val(team[2].name);
    $('#teamName4').val(team[3].name);
    var playingTeamCount = 1;
    var teamTurnIndex = 0;
   
    $(function () {
        $('.unsolved').click(function () {
            if (!$('#checkWordBox').is(':visible')) {
                $curr = $(this).children().siblings('.unhide');
                $currClass = $(this);
                var indexAttr = $currClass.attr('index');
                if (unhideUnavailableRow[indexAttr] == 1) {
                    $selectedRow = $currClass;
                    if ($currClass.children('.unhiddenCard').length < ($currClass.attr('len') - 1)) {
                        $curr.addClass("unhiddenCard").removeClass('unhide');
                        $curr.next().addClass('unhide');
                        $currClass.addClass('currentRow');
                    }
                    else {
                        $curr.addClass('lastBox').removeClass('unhide');
                        $currClass.removeClass('currentRow');
                    }
                    $('#teamTurn').hide();
                    $('#checkWordBox').show();
                    $('#checkWord').val('');
                }
            }
        });
    });

    $('input[type=radio][name=Team]').change(function () {
        playingTeamCount = parseInt(this.value);
        switch (this.value) {
            case "4":
                $('.team4, .team3, .team2, .team1').addClass('displayFlex'); break;
            case "3":
                $('.team3, .team2, .team1').addClass('displayFlex'); $('.team4').removeClass('displayFlex'); break;
            case "2":
                $('.team2, .team1').addClass('displayFlex'); $('.team4, .team3').removeClass('displayFlex'); break;
            case "1":
                $('.team1').addClass('displayFlex'); $('.team4, .team3, .team2').removeClass('displayFlex');
        }
    });
    $('#startGameBtn button').click(function () {
        for (var index = 0; index < playingTeamCount; index++) {
            playingTeam.push(team[index]);
            var tmp = '#teamName' + (index + 1);
            playingTeam[index].name = $(tmp).val().trim() || team[index].name;
        }
        $('.displayBox').removeClass('col-md-12').addClass('col-md-6');
        $('#team').hide();
        $('.controlPanel, .scoreBoard, #GameOn, .nextButton').addClass('displayFlex');
        gameInitialSetup();
        displayScore();
        teamTurn();
    });

    $('.nextButton').click(function () {
        if (indexTrack < list.length - 1)
            ++indexTrack;
        gameInitialSetup();
    });
    function addScore(index, score) {
        for (var i = 0; i < playingTeam.length; i++) {
            if (team[index].name == playingTeam[i].name) {
                playingTeam[i].score += score;
                break;
            }
        }
    }
    function displayScore() {
        $('.scoreBoard').html('');
        playingTeam.sort(function (a, b) {
            return b.score - a.score;
        });
        for (var i = 0; i < playingTeamCount; i++) {
            $('.scoreBoard').append('<div><span>' + playingTeam[i].symbol + '</span>' + playingTeam[i].name + ' - <span>' + playingTeam[i].score + '</span></div>')
        }
    }
    if (indexTrack < list.length)
        gameInitialSetup();
    function generateRandomLetter() {
        const alphabet = "abcdefghijklmnopqrstuvwxyz"
        return alphabet[Math.floor(Math.random() * alphabet.length)]
    }

    function loopAlphabetStyle(className, currentIndex, word) {
        $(className).append('<td></td>');
        let timer = null;
        let x = 0;
        word = (word == undefined ? '' : word);
        timer = setInterval(() => {
            $(className).children().eq(currentIndex).html(generateRandomLetter());
            x++;
            if (x >= maxWordLen) {
                clearInterval(timer);
                timer = null;
                $(className).children().eq(currentIndex).html(word);
            }
        }, 130);
    };
    function gameInitialSetup() {
        var i = index[indexTrack];
        unhideUnavailableRow = [0, 1, 0, 0, 1]; //reset row tracker
        $('.firstWord, .secondWord, .thirdWord, .fourthWord, .fifthWord, .lastWord').html('');
        $('.secondWord, .thirdWord, .fourthWord, .fifthWord').addClass('unsolved').removeClass('currentRow');
        for (var j = 0; j < list[i].length; j++) {
            var newStr = list[i][j].split("");
            for (var m = 0; m < maxWordLen; m++) {
                switch (j) {
                    case 0:
                        loopAlphabetStyle($('.firstWord'), m, newStr[m]);
                        break;
                    case 1:
                        (m >= newStr.length
                            ? $('.secondWord').append('<td></td>')
                            : $('.secondWord').append(m == 0 ? '<td class="unhide">' + newStr[m] + '</td>' : '<td>' + newStr[m] + '</td>'));
                        $('.secondWord').attr({ 'len': newStr.length, 'word': list[i][j], 'index': 1 });
                        break;
                    case 2:
                        (m >= newStr.length
                            ? $('.thirdWord').append('<td></td>')
                            : $('.thirdWord').append(m == 0 ? '<td class="unhide">' + newStr[m] + '</td>' : '<td>' + newStr[m] + '</td>'));
                        $('.thirdWord').attr({ 'len': newStr.length, 'word': list[i][j], 'index': 2 });
                        break;
                    case 3:
                        (m >= newStr.length
                            ? $('.fourthWord').append('<td></td>')
                            : $('.fourthWord').append(m == 0 ? '<td class="unhide">' + newStr[m] + '</td>' : '<td>' + newStr[m] + '</td>'));
                        $('.fourthWord').attr({ 'len': newStr.length, 'word': list[i][j], 'index': 3 });
                        break;
                    case 4:
                        (m >= newStr.length
                            ? $('.fifthWord').append('<td></td>')
                            : $('.fifthWord').append(m == 0 ? '<td class="unhide">' + newStr[m] + '</td>' : '<td>' + newStr[m] + '</td>'));
                        $('.fifthWord').attr({ 'len': newStr.length, 'word': list[i][j], 'index': 4 });
                        break;
                    case 5:
                        loopAlphabetStyle($('.lastWord'), m, newStr[m]);
                        /* (m >= newStr.length
                            ? $('.lastWord').append('<td></td>')
                            : $('.lastWord').append('<td>' + newStr[m] + '</td>')); */
                        break;
                }
            }
        }
    }

    function teamTurn() {
        $('#teamTurn').html('<div><b>' + team[teamTurnIndex].name + '</b>,<br/> Select A Position</div>');
        //$('.mainDisplay>.displayFlex, .mainDisplay>.displayBox').css({'background':playingTeam[teamTurnIndex].color});
        $('#teamTurn').show();
        $('#checkWordBox').hide();
    }
    function randomIndex(len) {
        var returnArr = [];
        while (returnArr.length < len) {
            var randNum = Math.floor(Math.random() * len);
            if ($.inArray(randNum, returnArr) == -1)
                returnArr.push(randNum);
        }
        return returnArr;
    }



    $('.checkWordBtn').click(function () {
        $currClass.removeClass('currentRow'); //remove animation
        var checkWord = $('#checkWord').val().trim().toUpperCase();
        if (checkWord == $selectedRow.attr('word').toUpperCase()) {
            $selectedRow.children('td').addClass('unhiddenCard').removeClass('lastBox');
            $selectedRow.removeClass('unsolved');
            var index = $selectedRow.attr('index');
            unhideUnavailableRow[index] = 0;
            (index == 1 || index == 2
                ? unhideUnavailableRow[++index] = 1
                : unhideUnavailableRow[--index] = 1);
            $('#checkWord').val('');
            if ($('.unsolved').length == 0) {
                addScore(teamTurnIndex, 20);
                fullChainForm();
            }
            else {
                addScore(teamTurnIndex, 10);
            }
            displayScore();
            teamTurn();
        }
        else {
            $selectedRow.children('.lastBox').removeClass('lastBox').addClass('unhide');
            $currClass.addClass('wrongAnswer');
            setTimeout(function () { $currClass.removeClass('wrongAnswer'); }, 2000);
            if (playingTeamCount - teamTurnIndex == 1)
                teamTurnIndex = 0;
            else
                teamTurnIndex++;

            teamTurn();

        }
    });
    function fullChainForm() {

    }
    function enterKeyPressed(event) {
        if (event.keyCode == 13) {
            $('.checkWordBtn').trigger('click');
            return true;
        }
    }
    $(".switch input").click(function(){ //color theme changer
        if($('.switch input').is(':checked')){
           $('body').addClass('blue');
           //$('.slider').before().css({'background-color':'#65dfc9'});
        }
        else{
            $('body').removeClass('blue');
            //$('.slider').before().css({'background-color':'#ffc487'});
        }
    });

</script>